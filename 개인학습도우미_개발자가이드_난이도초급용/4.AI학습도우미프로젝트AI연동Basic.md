# Day 4: AI 기능 통합 (초급자용)

## 🎯 오늘의 목표
- 간단한 AI 채팅 API 만들기
- 파일 내용 읽어서 AI에게 질문하기
- Frontend에 채팅 화면 만들기
- Backend와 AI 모듈 연결하기

## 1. AI 모듈 기본 설정

### 1-1. 간단한 FastAPI 서버 🤖
```python
# ai-module/main.py
from fastapi import FastAPI, HTTPException, UploadFile, File
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
import openai
import os
import PyPDF2
import io
from typing import Optional

# FastAPI 앱 생성
app = FastAPI(title="AI Learning Assistant", version="1.0.0")

# CORS 설정 (React에서 접근할 수 있도록)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000", "http://localhost:8080"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# OpenAI API 키 설정
openai.api_key = os.getenv("OPENAI_API_KEY", "your-api-key-here")

# 요청/응답 모델 정의
class ChatRequest(BaseModel):
    question: str
    file_content: Optional[str] = None
    user_id: int

class ChatResponse(BaseModel):
    answer: str
    success: bool
    message: str = "성공"

# 간단한 메모리 저장소 (실제로는 데이터베이스 사용)
file_contents = {}  # {file_id: content}
chat_history = {}   # {user_id: [messages]}

@app.get("/")
def read_root():
    """AI 서비스 상태 확인"""
    return {"message": "AI Learning Assistant가 실행 중입니다!", "status": "healthy"}

@app.get("/health")
def health_check():
    """헬스체크 엔드포인트"""
    return {"status": "healthy", "service": "AI Learning Assistant"}

@app.post("/chat", response_model=ChatResponse)
async def chat_with_ai(request: ChatRequest):
    """AI와 채팅하기"""
    try:
        # 시스템 메시지 설정
        system_message = "당신은 도움이 되는 AI 학습 도우미입니다. 한국어로 답변해주세요."
        
        # 파일 내용이 있으면 포함
        if request.file_content:
            system_message += f"\n\n다음은 사용자가 업로드한 문서의 내용입니다:\n{request.file_content[:2000]}"
        
        # OpenAI API 호출
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": system_message},
                {"role": "user", "content": request.question}
            ],
            max_tokens=500,
            temperature=0.7
        )
        
        answer = response.choices[0].message.content
        
        # 채팅 기록 저장
        if request.user_id not in chat_history:
            chat_history[request.user_id] = []
        
        chat_history[request.user_id].append({
            "question": request.question,
            "answer": answer
        })
        
        return ChatResponse(
            answer=answer,
            success=True,
            message="AI 응답이 생성되었습니다."
        )
        
    except Exception as e:
        print(f"AI 채팅 오류: {str(e)}")
        return ChatResponse(
            answer="죄송합니다. AI 응답을 생성하는 중 오류가 발생했습니다.",
            success=False,
            message=str(e)
        )

@app.post("/upload-text")
async def extract_text_from_file(file: UploadFile = File(...)):
    """업로드된 파일에서 텍스트 추출"""
    try:
        content = ""
        
        if file.filename.endswith('.txt'):
            # 텍스트 파일 읽기
            content = (await file.read()).decode('utf-8')
            
        elif file.filename.endswith('.pdf'):
            # PDF 파일 읽기
            pdf_content = await file.read()
            pdf_file = io.BytesIO(pdf_content)
            pdf_reader = PyPDF2.PdfReader(pdf_file)
            
            # 모든 페이지의 텍스트 추출
            for page in pdf_reader.pages:
                content += page.extract_text() + "\n"
        
        else:
            raise HTTPException(status_code=400, detail="지원하지 않는 파일 형식입니다.")
        
        return {
            "success": True,
            "content": content[:5000],  # 처음 5000자만 반환
            "filename": file.filename,
            "length": len(content)
        }
        
    except Exception as e:
        print(f"파일 텍스트 추출 오류: {str(e)}")
        raise HTTPException(status_code=500, detail=f"파일 처리 중 오류: {str(e)}")

@app.get("/chat-history/{user_id}")
def get_chat_history(user_id: int):
    """사용자의 채팅 기록 조회"""
    return {
        "success": True,
        "history": chat_history.get(user_id, []),
        "count": len(chat_history.get(user_id, []))
    }

# 간단한 퀴즈 생성 (보너스 기능)
@app.post("/generate-quiz")
async def generate_quiz(request: ChatRequest):
    """파일 내용 기반 간단한 퀴즈 생성"""
    try:
        if not request.file_content:
            raise HTTPException(status_code=400, detail="퀴즈를 생성할 파일 내용이 필요합니다.")
        
        quiz_prompt = f"""
        다음 내용을 바탕으로 간단한 객관식 문제 3개를 만들어주세요.
        각 문제는 다음 형식으로 작성해주세요:
        
        문제 1: [질문]
        1) [선택지1]
        2) [선택지2]
        3) [선택지3]
        4) [선택지4]
        정답: [번호]
        
        내용: {request.file_content[:1500]}
        """
        
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "당신은 교육용 퀴즈를 만드는 전문가입니다."},
                {"role": "user", "content": quiz_prompt}
            ],
            max_tokens=800,
            temperature=0.5
        )
        
        quiz_content = response.choices[0].message.content
        
        return {
            "success": True,
            "quiz": quiz_content,
            "message": "퀴즈가 생성되었습니다."
        }
        
    except Exception as e:
        print(f"퀴즈 생성 오류: {str(e)}")
        return {
            "success": False,
            "quiz": "",
            "message": f"퀴즈 생성 중 오류: {str(e)}"
        }

if __name__ == "__main__":
    import uvicorn
    print("🤖 AI Learning Assistant 시작 중...")
    print("📝 Swagger UI: http://localhost:8000/docs")
    uvicorn.run(app, host="0.0.0.0", port=8000, reload=True)
```

### 1-2. 환경변수 설정 🔑
```bash
# ai-module/.env
OPENAI_API_KEY=your-openai-api-key-here

# 실제 OpenAI API 키를 발급받아서 입력하세요
# https://platform.openai.com/api-keys
```

## 2. Backend에서 AI 서비스 연동

### 2-1. AI 서비스 클라이언트 🔌
```java
// backend/src/main/java/com/smartlearning/service/AIService.java
package com.smartlearning.service;

import org.springframework.stereotype.Service;
import org.springframework.web.reactive.function.client.WebClient;
import org.springframework.core.io.ByteArrayResource;
import org.springframework.http.MediaType;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;

import java.util.Map;
import java.util.HashMap;

@Service
public class AIService {
    
    private final WebClient webClient;
    private final String AI_SERVICE_URL = "http://localhost:8000";
    
    public AIService() {
        this.webClient = WebClient.builder()
                .baseUrl(AI_SERVICE_URL)
                .build();
    }
    
    // AI와 채팅
    public Map<String, Object> chatWithAI(String question, String fileContent, Long userId) {
        try {
            Map<String, Object> requestBody = new HashMap<>();
            requestBody.put("question", question);
            requestBody.put("file_content", fileContent);
            requestBody.put("user_id", userId);
            
            Map<String, Object> response = webClient.post()
                    .uri("/chat")
                    .contentType(MediaType.APPLICATION_JSON)
                    .bodyValue(requestBody)
                    .retrieve()
                    .bodyToMono(Map.class)
                    .block();
            
            return response;
            
        } catch (Exception e) {
            System.out.println("AI 채팅 오류: " + e.getMessage());
            Map<String, Object> errorResponse = new HashMap<>();
            errorResponse.put("success", false);
            errorResponse.put("answer", "AI 서비스 연결에 실패했습니다.");
            errorResponse.put("message", e.getMessage());
            return errorResponse;
        }
    }
    
    // 파일에서 텍스트 추출
    public Map<String, Object> extractTextFromFile(MultipartFile file) {
        try {
            // MultipartFile을 AI 서비스로 전송
            MultiValueMap<String, Object> parts = new LinkedMultiValueMap<>();
            parts.add("file", new ByteArrayResource(file.getBytes()) {
                @Override
                public String getFilename() {
                    return file.getOriginalFilename();
                }
            });
            
            Map<String, Object> response = webClient.post()
                    .uri("/upload-text")
                    .contentType(MediaType.MULTIPART_FORM_DATA)
                    .bodyValue(parts)
                    .retrieve()
                    .bodyToMono(Map.class)
                    .block();
            
            return response;
            
        } catch (Exception e) {
            System.out.println("텍스트 추출 오류: " + e.getMessage());
            Map<String, Object> errorResponse = new HashMap<>();
            errorResponse.put("success", false);
            errorResponse.put("content", "");
            errorResponse.put("message", e.getMessage());
            return errorResponse;
        }
    }
    
    // 퀴즈 생성
    public Map<String, Object> generateQuiz(String fileContent, Long userId) {
        try {
            Map<String, Object> requestBody = new HashMap<>();
            requestBody.put("question", "퀴즈를 만들어주세요");
            requestBody.put("file_content", fileContent);
            requestBody.put("user_id", userId);
            
            Map<String, Object> response = webClient.post()
                    .uri("/generate-quiz")
                    .contentType(MediaType.APPLICATION_JSON)
                    .bodyValue(requestBody)
                    .retrieve()
                    .bodyToMono(Map.class)
                    .block();
            
            return response;
            
        } catch (Exception e) {
            System.out.println("퀴즈 생성 오류: " + e.getMessage());
            Map<String, Object> errorResponse = new HashMap<>();
            errorResponse.put("success", false);
            errorResponse.put("quiz", "");
            errorResponse.put("message", e.getMessage());
            return errorResponse;
        }
    }
    
    // AI 서비스 상태 확인
    public boolean isAIServiceHealthy() {
        try {
            Map<String, Object> response = webClient.get()
                    .uri("/health")
                    .retrieve()
                    .bodyToMono(Map.class)
                    .block();
            
            return "healthy".equals(response.get("status"));
            
        } catch (Exception e) {
            System.out.println("AI 서비스 상태 확인 실패: " + e.getMessage());
            return false;
        }
    }
}
```

### 2-2. 채팅 히스토리 Entity 추가 💬
```java
// backend/src/main/java/com/smartlearning/entity/ChatHistory.java
package com.smartlearning.entity;

import jakarta.persistence.*;
import org.hibernate.annotations.CreationTimestamp;
import java.time.LocalDateTime;

@Entity
@Table(name = "chat_history")
public class ChatHistory {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private Long userId;
    
    @Column(nullable = true)
    private Long fileId;
    
    @Column(columnDefinition = "TEXT", nullable = false)
    private String question;
    
    @Column(columnDefinition = "TEXT")
    private String answer;
    
    @CreationTimestamp
    private LocalDateTime createdAt;
    
    // 기본 생성자
    public ChatHistory() {}
    
    // 생성자
    public ChatHistory(Long userId, String question, String answer) {
        this.userId = userId;
        this.question = question;
        this.answer = answer;
    }
    
    // Getter와 Setter
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    
    public Long getUserId() { return userId; }
    public void setUserId(Long userId) { this.userId = userId; }
    
    public Long getFileId() { return fileId; }
    public void setFileId(Long fileId) { this.fileId = fileId; }
    
    public String getQuestion() { return question; }
    public void setQuestion(String question) { this.question = question; }
    
    public String getAnswer() { return answer; }
    public void setAnswer(String answer) { this.answer = answer; }
    
    public LocalDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }
}
```

### 2-3. 채팅 Repository 📁
```java
// backend/src/main/java/com/smartlearning/repository/ChatHistoryRepository.java
package com.smartlearning.repository;

import com.smartlearning.entity.ChatHistory;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.List;

@Repository
public interface ChatHistoryRepository extends JpaRepository<ChatHistory, Long> {
    
    // 사용자별 채팅 기록 조회 (최신순)
    List<ChatHistory> findByUserIdOrderByCreatedAtDesc(Long userId);
    
    // 특정 파일과 관련된 채팅 기록
    List<ChatHistory> findByUserIdAndFileIdOrderByCreatedAtDesc(Long userId, Long fileId);
    
    // 사용자별 최근 N개 채팅 기록
    List<ChatHistory> findTop10ByUserIdOrderByCreatedAtDesc(Long userId);
}
```

### 2-4. AI 컨트롤러 🎮
```java
// backend/src/main/java/com/smartlearning/controller/AIController.java
package com.smartlearning.controller;

import com.smartlearning.dto.ApiResponse;
import com.smartlearning.entity.ChatHistory;
import com.smartlearning.entity.UploadedFile;
import com.smartlearning.service.AIService;
import com.smartlearning.service.FileService;
import com.smartlearning.repository.ChatHistoryRepository;
import com.smartlearning.repository.FileRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.FileInputStream;
import java.util.List;
import java.util.Map;
import java.util.HashMap;

@RestController
@RequestMapping("/api/ai")
@CrossOrigin(origins = "http://localhost:3000")
public class AIController {
    
    @Autowired
    private AIService aiService;
    
    @Autowired
    private ChatHistoryRepository chatHistoryRepository;
    
    @Autowired
    private FileRepository fileRepository;
    
    // AI와 채팅
    @PostMapping("/chat")
    public ApiResponse<Map<String, Object>> chatWithAI(@RequestBody Map<String, Object> request) {
        try {
            String question = (String) request.get("question");
            Long userId = Long.valueOf(request.get("userId").toString());
            Long fileId = request.get("fileId") != null ? 
                Long.valueOf(request.get("fileId").toString()) : null;
            
            String fileContent = "";
            
            // 파일이 지정된 경우 파일 내용 읽기
            if (fileId != null) {
                UploadedFile file = fileRepository.findById(fileId).orElse(null);
                if (file != null) {
                    // 파일에서 텍스트 추출 (간단한 방법)
                    fileContent = readFileContent(file.getFilePath());
                }
            }
            
            // AI 서비스 호출
            Map<String, Object> aiResponse = aiService.chatWithAI(question, fileContent, userId);
            
            // 채팅 기록 저장
            if ((Boolean) aiResponse.get("success")) {
                ChatHistory chatHistory = new ChatHistory(userId, question, (String) aiResponse.get("answer"));
                if (fileId != null) {
                    chatHistory.setFileId(fileId);
                }
                chatHistoryRepository.save(chatHistory);
            }
            
            return ApiResponse.success(aiResponse);
            
        } catch (Exception e) {
            Map<String, Object> errorResponse = new HashMap<>();
            errorResponse.put("success", false);
            errorResponse.put("answer", "채팅 처리 중 오류가 발생했습니다.");
            errorResponse.put("message", e.getMessage());
            return ApiResponse.error(e.getMessage());
        }
    }
    
    // 파일 기반 퀴즈 생성
    @PostMapping("/quiz")
    public ApiResponse<Map<String, Object>> generateQuiz(@RequestBody Map<String, Object> request) {
        try {
            Long userId = Long.valueOf(request.get("userId").toString());
            Long fileId = Long.valueOf(request.get("fileId").toString());
            
            // 파일 내용 읽기
            UploadedFile file = fileRepository.findById(fileId)
                .orElseThrow(() -> new RuntimeException("파일을 찾을 수 없습니다."));
            
            String fileContent = readFileContent(file.getFilePath());
            
            // AI 서비스로 퀴즈 생성 요청
            Map<String, Object> quizResponse = aiService.generateQuiz(fileContent, userId);
            
            return ApiResponse.success(quizResponse);
            
        } catch (Exception e) {
            Map<String, Object> errorResponse = new HashMap<>();
            errorResponse.put("success", false);
            errorResponse.put("quiz", "");
            errorResponse.put("message", e.getMessage());
            return ApiResponse.error(e.getMessage());
        }
    }
    
    // 채팅 기록 조회
    @GetMapping("/chat-history/{userId}")
    public ApiResponse<List<ChatHistory>> getChatHistory(@PathVariable Long userId) {
        try {
            List<ChatHistory> history = chatHistoryRepository.findTop10ByUserIdOrderByCreatedAtDesc(userId);
            return ApiResponse.success(history);
        } catch (Exception e) {
            return ApiResponse.error("채팅 기록 조회 실패: " + e.getMessage());
        }
    }
    
    // 파일에서 텍스트 추출
    @PostMapping("/extract-text")
    public ApiResponse<Map<String, Object>> extractText(@RequestParam("file") MultipartFile file) {
        try {
            Map<String, Object> response = aiService.extractTextFromFile(file);
            return ApiResponse.success(response);
        } catch (Exception e) {
            return ApiResponse.error("텍스트 추출 실패: " + e.getMessage());
        }
    }
    
    // AI 서비스 상태 확인
    @GetMapping("/health")
    public ApiResponse<Map<String, Object>> checkAIHealth() {
        Map<String, Object> status = new HashMap<>();
        status.put("ai_service_healthy", aiService.isAIServiceHealthy());
        status.put("message", "AI 서비스 상태 확인 완료");
        return ApiResponse.success(status);
    }
    
    // 간단한 파일 내용 읽기 (텍스트 파일만)
    private String readFileContent(String filePath) {
        try {
            File file = new File(filePath);
            if (!file.exists()) {
                return "";
            }
            
            if (filePath.endsWith(".txt")) {
                FileInputStream fis = new FileInputStream(file);
                byte[] data = new byte[(int) file.length()];
                fis.read(data);
                fis.close();
                return new String(data, "UTF-8");
            }
            
            return "파일 내용을 읽을 수 없습니다. (PDF 지원 예정)";
            
        } catch (Exception e) {
            System.out.println("파일 읽기 오류: " + e.getMessage());
            return "";
        }
    }
}
```

## 3. Frontend에 AI 채팅 기능 추가

### 3-1. AI 서비스 추가 🤖
```javascript
// frontend/src/services/aiService.js
import api from './api';

export const aiService = {
  // AI와 채팅
  chat: async (question, userId, fileId = null) => {
    try {
      const response = await api.post('/ai/chat', {
        question,
        userId,
        fileId
      });
      return response.data;
    } catch (error) {
      throw error.response?.data || error;
    }
  },

  // 퀴즈 생성
  generateQuiz: async (userId, fileId) => {
    try {
      const response = await api.post('/ai/quiz', {
        userId,
        fileId
      });
      return response.data;
    } catch (error) {
      throw error.response?.data || error;
    }
  },

  // 채팅 기록 조회
  getChatHistory: async (userId) => {
    try {
      const response = await api.get(`/ai/chat-history/${userId}`);
      return response.data;
    } catch (error) {
      throw error.response?.data || error;
    }
  },

  // 파일에서 텍스트 추출
  extractText: async (file) => {
    try {
      const formData = new FormData();
      formData.append('file', file);

      const response = await api.post('/ai/extract-text', formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
      return response.data;
    } catch (error) {
      throw error.response?.data || error;
    }
  },

  // AI 서비스 상태 확인
  checkHealth: async () => {
    try {
      const response = await api.get('/ai/health');
      return response.data;
    } catch (error) {
      throw error.response?.data || error;
    }
  }
};
```

### 3-2. 채팅 컴포넌트 💬
```javascript
// frontend/src/components/chat/ChatInterface.js
import React, { useState, useEffect, useRef } from 'react';
import { aiService } from '../../services/aiService';
import Loading from '../common/Loading';
import Alert from '../common/Alert';
import './Chat.css';

const ChatInterface = ({ user, selectedFile }) => {
  const [messages, setMessages] = useState([]);
  const [currentMessage, setCurrentMessage] = useState('');
  const [loading, setLoading] = useState(false);
  const [alert, setAlert] = useState(null);
  const messagesEndRef = useRef(null);

  // 메시지 목록 끝으로 스크롤
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // 채팅 기록 불러오기
  useEffect(() => {
    loadChatHistory();
  }, [user.id]);

  const loadChatHistory = async () => {
    try {
      const response = await aiService.getChatHistory(user.id);
      if (response.success) {
        // 최근 5개 메시지만 표시
        const recentMessages = response.data.slice(0, 5).reverse().map(chat => [
          { type: 'user', content: chat.question, timestamp: chat.createdAt },
          { type: 'ai', content: chat.answer, timestamp: chat.createdAt }
        ]).flat();
        setMessages(recentMessages);
      }
    } catch (error) {
      console.error('채팅 기록 로드 실패:', error);
    }
  };

  // 메시지 전송
  const sendMessage = async () => {
    if (!currentMessage.trim()) return;

    const userMessage = {
      type: 'user',
      content: currentMessage,
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    setCurrentMessage('');
    setLoading(true);
    setAlert(null);

    try {
      const response = await aiService.chat(
        currentMessage,
        user.id,
        selectedFile?.id
      );

      if (response.success && response.data.success) {
        const aiMessage = {
          type: 'ai',
          content: response.data.answer,
          timestamp: new Date()
        };
        setMessages(prev => [...prev, aiMessage]);
      } else {
        setAlert({
          type: 'error',
          message: response.data.message || 'AI 응답 생성에 실패했습니다.'
        });
      }
    } catch (error) {
      setAlert({
        type: 'error',
        message: '채팅 중 오류가 발생했습니다.'
      });
      console.error('채팅 오류:', error);
    } finally {
      setLoading(false);
    }
  };

  // 엔터키로 메시지 전송
  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };

  // 예시 질문들
  const exampleQuestions = [
    "이 문서의 주요 내용을 요약해주세요",
    "핵심 포인트를 3가지로 정리해주세요",
    "이해하기 어려운 부분을 설명해주세요",
    "문서와 관련된 퀴즈를 만들어주세요"
  ];

  return (
    <div className="chat-interface">
      <div className="chat-header">
        <h3>🤖 AI 학습 도우미</h3>
        {selectedFile && (
          <div className="selected-file-info">
            📄 {selectedFile.originalFilename}
          </div>
        )}
      </div>

      {alert && (
        <Alert
          type={alert.type}
          message={alert.message}
          onClose={() => setAlert(null)}
        />
      )}

      <div className="chat-messages">
        {messages.length === 0 ? (
          <div className="welcome-message">
            <div className="ai-avatar">🤖</div>
            <div className="welcome-text">
              <h4>안녕하세요! AI 학습 도우미입니다.</h4>
              <p>궁금한 것이 있으면 언제든 물어보세요!</p>
              {selectedFile && (
                <p>현재 <strong>{selectedFile.originalFilename}</strong> 파일에 대해 질문할 수 있습니다.</p>
              )}
            </div>
          </div>
        ) : (
          messages.map((message, index) => (
            <div key={index} className={`message ${message.type}`}>
              <div className="message-avatar">
                {message.type === 'user' ? '👤' : '🤖'}
              </div>
              <div className="message-content">
                <div className="message-text">{message.content}</div>
                <div className="message-time">
                  {new Date(message.timestamp).toLocaleTimeString()}
                </div>
              </div>
            </div>
          ))
        )}

        {loading && (
          <div className="message ai">
            <div className="message-avatar">🤖</div>
            <div className="message-content">
              <div className="typing-indicator">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        )}

        <div ref={messagesEndRef} />
      </div>

      {/* 예시 질문들 (메시지가 없을 때만 표시) */}
      {messages.length === 0 && (
        <div className="example-questions">
          <p>💡 이런 질문을 해보세요:</p>
          <div className="example-buttons">
            {exampleQuestions.map((question, index) => (
              <button
                key={index}
                className="example-button"
                onClick={() => setCurrentMessage(question)}
              >
                {question}
              </button>
            ))}
          </div>
        </div>
      )}

      <div className="chat-input">
        <div className="input-container">
          <textarea
            value={currentMessage}
            onChange={(e) => setCurrentMessage(e.target.value)}
            onKeyPress={handleKeyPress}
            placeholder={selectedFile ? 
              "파일에 대해 질문해보세요..." : 
              "무엇이든 질문해보세요..."
            }
            disabled={loading}
            rows={1}
          />
          <button
            onClick={sendMessage}
            disabled={!currentMessage.trim() || loading}
            className="send-button"
          >
            {loading ? '⏳' : '📤'}
          </button>
        </div>
      </div>
    </div>
  );
};

export default ChatInterface;
```

### 3-3. 채팅 스타일 🎨
```css
/* frontend/src/components/chat/Chat.css */
.chat-interface {
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
  height: 600px;
  overflow: hidden;
}

.chat-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chat-header h3 {
  margin: 0;
  font-size: 18px;
}

.selected-file-info {
  background: rgba(255, 255, 255, 0.2);
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 12px;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.welcome-message {
  display: flex;
  align-items: flex-start;
  gap: 15px;
  padding: 20px;
  background: #f8f9ff;
  border-radius: 10px;
  margin-bottom: 20px;
}

.ai-avatar {
  font-size: 40px;
}

.welcome-text h4 {
  margin: 0 0 5px 0;
  color: #333;
}

.welcome-text p {
  margin: 5px 0;
  color: #666;
  line-height: 1.5;
}

.message {
  display: flex;
  gap: 10px;
  max-width: 80%;
}

.message.user {
  align-self: flex-end;
  flex-direction: row-reverse;
}

.message.ai {
  align-self: flex-start;
}

.message-avatar {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}

.message.user .message-avatar {
  background: #667eea;
}

.message.ai .message-avatar {
  background: #f1f3f4;
}

.message-content {
  display: flex;
  flex-direction: column;
}

.message-text {
  background: #f1f3f4;
  padding: 12px 16px;
  border-radius: 18px;
  word-wrap: break-word;
  line-height: 1.4;
}

.message.user .message-text {
  background: #667eea;
  color: white;
}

.message-time {
  font-size: 11px;
  color: #999;
  margin-top: 5px;
  text-align: right;
}

.message.user .message-time {
  text-align: left;
}

.typing-indicator {
  display: flex;
  gap: 4px;
  padding: 12px 16px;
  background: #f1f3f4;
  border-radius: 18px;
}

.typing-indicator span {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #999;
  animation: typing 1.4s infinite ease-in-out;
}

.typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
.typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1); }
}

.example-questions {
  padding: 0 20px 20px;
  text-align: center;
}

.example-questions p {
  margin-bottom: 15px;
  color: #666;
  font-size: 14px;
}

.example-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
}

.example-button {
  background: #f8f9ff;
  border: 1px solid #e2e8f0;
  color: #667eea;
  padding: 8px 12px;
  border-radius: 20px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.example-button:hover {
  background: #667eea;
  color: white;
}

.chat-input {
  border-top: 1px solid #e2e8f0;
  padding: 15px 20px;
}

.input-container {
  display: flex;
  gap: 10px;
  align-items: flex-end;
}

.input-container textarea {
  flex: 1;
  border: 1px solid #e2e8f0;
  border-radius: 20px;
  padding: 10px 15px;
  resize: none;
  outline: none;
  font-family: inherit;
  font-size: 14px;
  line-height: 1.4;
  max-height: 100px;
  min-height: 40px;
}

.input-container textarea:focus {
  border-color: #667eea;
}

.send-button {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  background: #667eea;
  color: white;
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.send-button:hover:not(:disabled) {
  background: #5a67d8;
  transform: scale(1.05);
}

.send-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* 모바일 반응형 */
@media (max-width: 768px) {
  .chat-interface {
    height: 500px;
  }
  
  .message {
    max-width: 90%;
  }
  
  .example-buttons {
    flex-direction: column;
    align-items: center;
  }
  
  .example-button {
    width: 100%;
    max-width: 250px;
  }
}
```

### 3-4. 파일 선택 컴포넌트 📂
```javascript
// frontend/src/components/file/FileSelector.js
import React from 'react';
import './File.css';

const FileSelector = ({ files, selectedFile, onFileSelect }) => {
  return (
    <div className="file-selector">
      <h4>📂 AI와 대화할 파일 선택</h4>
      
      {files.length === 0 ? (
        <div className="no-files">
          <p>업로드된 파일이 없습니다.</p>
          <p>먼저 파일을 업로드해주세요.</p>
        </div>
      ) : (
        <div className="file-options">
          <div 
            className={`file-option ${!selectedFile ? 'selected' : ''}`}
            onClick={() => onFileSelect(null)}
          >
            <div className="file-icon">💬</div>
            <div className="file-details">
              <div className="file-name">일반 대화</div>
              <div className="file-description">파일 없이 AI와 자유롭게 대화</div>
            </div>
          </div>
          
          {files.map((file) => (
            <div 
              key={file.id}
              className={`file-option ${selectedFile?.id === file.id ? 'selected' : ''}`}
              onClick={() => onFileSelect(file)}
            >
              <div className="file-icon">
                {file.originalFilename.endsWith('.pdf') && '📄'}
                {file.originalFilename.endsWith('.txt') && '📝'}
                {file.originalFilename.endsWith('.docx') && '📘'}
              </div>
              <div className="file-details">
                <div className="file-name">{file.originalFilename}</div>
                <div className="file-description">
                  {new Date(file.uploadedAt).toLocaleDateString()}
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default FileSelector;
```

## 4. 대시보드에 AI 채팅 추가

### 4-1. 업데이트된 대시보드 🏠
```javascript
// frontend/src/pages/Dashboard.js (업데이트)
import React, { useState, useEffect } from 'react';
import FileUpload from '../components/file/FileUpload';
import FileList from '../components/file/FileList';
import FileSelector from '../components/file/FileSelector';
import ChatInterface from '../components/chat/ChatInterface';
import { fileService } from '../services/fileService';
import { aiService } from '../services/aiService';
import Alert from '../components/common/Alert';
import './Dashboard.css';

const Dashboard = ({ user, onLogout }) => {
  const [refreshTrigger, setRefreshTrigger] = useState(0);
  const [userFiles, setUserFiles] = useState([]);
  const [selectedFile, setSelectedFile] = useState(null);
  const [activeTab, setActiveTab] = useState('files'); // 'files' 또는 'chat'
  const [aiHealthy, setAiHealthy] = useState(false);
  const [alert, setAlert] = useState(null);

  // 파일 목록 로드
  useEffect(() => {
    loadUserFiles();
    checkAIHealth();
  }, [user.id, refreshTrigger]);

  const loadUserFiles = async () => {
    try {
      const response = await fileService.getUserFiles(user.id);
      if (response.success) {
        setUserFiles(response.data);
      }
    } catch (error) {
      console.error('파일 목록 로드 실패:', error);
    }
  };

  const checkAIHealth = async () => {
    try {
      const response = await aiService.checkHealth();
      setAiHealthy(response.success && response.data.ai_service_healthy);
    } catch (error) {
      setAiHealthy(false);
      console.error('AI 서비스 상태 확인 실패:', error);
    }
  };

  const handleUploadSuccess = () => {
    setRefreshTrigger(prev => prev + 1);
    setAlert({
      type: 'success',
      message: '파일이 업로드되었습니다! 이제 AI와 대화해보세요.'
    });
  };

  const handleFileSelect = (file) => {
    setSelectedFile(file);
    setActiveTab('chat');
  };

  return (
    <div className="dashboard-container">
      {/* 헤더 */}
      <header className="dashboard-header">
        <div className="header-content">
          <h1>📚 AI 학습도우미</h1>
          <div className="header-status">
            <div className={`ai-status ${aiHealthy ? 'healthy' : 'error'}`}>
              🤖 AI {aiHealthy ? '연결됨' : '연결 안됨'}
            </div>
            <div className="user-info">
              <span>안녕하세요, {user.name}님! 👋</span>
              <button className="logout-button" onClick={onLogout}>
                로그아웃
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* 탭 네비게이션 */}
      <nav className="tab-navigation">
        <div className="tab-container">
          <button
            className={`tab-button ${activeTab === 'files' ? 'active' : ''}`}
            onClick={() => setActiveTab('files')}
          >
            📁 파일 관리
          </button>
          <button
            className={`tab-button ${activeTab === 'chat' ? 'active' : ''}`}
            onClick={() => setActiveTab('chat')}
          >
            💬 AI 채팅
          </button>
        </div>
      </nav>

      {alert && (
        <div className="dashboard-alert">
          <Alert
            type={alert.type}
            message={alert.message}
            onClose={() => setAlert(null)}
          />
        </div>
      )}

      {/* 메인 콘텐츠 */}
      <main className="dashboard-main">
        <div className="dashboard-content">
          {activeTab === 'files' ? (
            // 파일 관리 탭
            <>
              <section className="upload-section">
                <FileUpload 
                  userId={user.id} 
                  onUploadSuccess={handleUploadSuccess}
                />
              </section>

              <section className="file-list-section">
                <FileList 
                  userId={user.id} 
                  refreshTrigger={refreshTrigger}
                />
              </section>

              {userFiles.length > 0 && (
                <section className="file-chat-section">
                  <div className="chat-invitation">
                    <h3>🚀 AI와 대화해보세요!</h3>
                    <p>업로드한 파일에 대해 AI에게 질문할 수 있습니다.</p>
                    <button 
                      className="start-chat-button"
                      onClick={() => setActiveTab('chat')}
                    >
                      채팅 시작하기
                    </button>
                  </div>
                </section>
              )}
            </>
          ) : (
            // AI 채팅 탭
            <div className="chat-section">
              <div className="chat-layout">
                <aside className="file-selector-sidebar">
                  <FileSelector 
                    files={userFiles}
                    selectedFile={selectedFile}
                    onFileSelect={handleFileSelect}
                  />
                </aside>
                
                <main className="chat-main">
                  {aiHealthy ? (
                    <ChatInterface 
                      user={user}
                      selectedFile={selectedFile}
                    />
                  ) : (
                    <div className="ai-unavailable">
                      <div className="ai-error-icon">⚠️</div>
                      <h3>AI 서비스에 연결할 수 없습니다</h3>
                      <p>AI 서비스가 실행되지 않았거나 연결에 문제가 있습니다.</p>
                      <button onClick={checkAIHealth} className="retry-button">
                        다시 시도
                      </button>
                    </div>
                  )}
                </main>
              </div>
            </div>
          )}
        </div>
      </main>
    </div>
  );
};

export default Dashboard;
```

### 4-2. 대시보드 스타일 업데이트 🎨
```css
/* frontend/src/pages/Dashboard.css (추가 스타일) */

/* 헤더 상태 표시 */
.header-status {
  display: flex;
  align-items: center;
  gap: 20px;
}

.ai-status {
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 12px;
  font-weight: 500;
}

.ai-status.healthy {
  background: #d4edda;
  color: #155724;
}

.ai-status.error {
  background: #f8d7da;
  color: #721c24;
}

/* 탭 네비게이션 */
.tab-navigation {
  background: white;
  border-bottom: 1px solid #e2e8f0;
  position: sticky;
  top: 70px;
  z-index: 50;
}

.tab-container {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  padding: 0 20px;
}

.tab-button {
  background: none;
  border: none;
  padding: 15px 20px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  color: #666;
  border-bottom: 3px solid transparent;
  transition: all 0.2s;
}

.tab-button.active {
  color: #667eea;
  border-bottom-color: #667eea;
}

.tab-button:hover {
  color: #667eea;
  background: #f8f9ff;
}

/* 대시보드 알림 */
.dashboard-alert {
  max-width: 1200px;
  margin: 20px auto;
  padding: 0 20px;
}

/* 채팅 섹션 */
.chat-section {
  padding: 20px;
}

.chat-layout {
  max-width: 1200px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 20px;
  height: 600px;
}

.file-selector-sidebar {
  background: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  overflow-y: auto;
}

.chat-main {
  display: flex;
  flex-direction: column;
}

/* 파일 선택기 스타일 */
.file-selector h4 {
  margin: 0 0 20px 0;
  color: #333;
  font-size: 16px;
}

.no-files {
  text-align: center;
  padding: 20px;
  color: #666;
}

.file-options {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.file-option {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.file-option:hover {
  border-color: #667eea;
  background: #f8f9ff;
}

.file-option.selected {
  border-color: #667eea;
  background: #667eea;
  color: white;
}

.file-option .file-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.file-option .file-details {
  flex: 1;
}

.file-option .file-name {
  font-weight: 500;
  font-size: 14px;
  margin-bottom: 2px;
}

.file-option .file-description {
  font-size: 12px;
  opacity: 0.7;
}

/* 채팅 초대 섹션 */
.chat-invitation {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  border-radius: 10px;
  text-align: center;
  margin-top: 20px;
}

.chat-invitation h3 {
  margin: 0 0 10px 0;
  font-size: 24px;
}

.chat-invitation p {
  margin: 0 0 20px 0;
  opacity: 0.9;
}

.start-chat-button {
  background: white;
  color: #667eea;
  border: none;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.start-chat-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

/* AI 서비스 불가 상태 */
.ai-unavailable {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  background: white;
  border-radius: 10px;
  padding: 40px;
  text-align: center;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.ai-error-icon {
  font-size: 60px;
  margin-bottom: 20px;
}

.ai-unavailable h3 {
  color: #e53e3e;
  margin: 0 0 10px 0;
}

.ai-unavailable p {
  color: #666;
  margin: 0 0 20px 0;
  line-height: 1.5;
}

.retry-button {
  background: #667eea;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.retry-button:hover {
  background: #5a67d8;
}

/* 모바일 반응형 */
@media (max-width: 1024px) {
  .chat-layout {
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr;
    height: auto;
  }
  
  .file-selector-sidebar {
    height: auto;
    max-height: 200px;
  }
  
  .chat-main {
    height: 500px;
  }
}

@media (max-width: 768px) {
  .header-status {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .tab-container {
    padding: 0 10px;
  }
  
  .tab-button {
    padding: 12px 15px;
    font-size: 13px;
  }
  
  .chat-section {
    padding: 10px;
  }
  
  .file-selector-sidebar {
    padding: 15px;
  }
}
```

## 5. 실행 및 테스트

### 5-1. 모든 서비스 실행 🚀
```bash
# 터미널 1: AI 서비스
cd ai-module
source venv/bin/activate  # Mac/Linux
# 또는 venv\Scripts\activate  # Windows
python main.py

# 터미널 2: Backend 서비스
cd backend
./mvnw spring-boot:run

# 터미널 3: Frontend 서비스
cd frontend
npm start
```

### 5-2. 기능 테스트 체크리스트 ✅

**AI 서비스 테스트:**
- [ ] AI 서비스가 정상 실행되는가? (http://localhost:8000)
- [ ] Swagger 문서가 접근 가능한가? (http://localhost:8000/docs)
- [ ] 헬스체크가 정상인가? (http://localhost:8000/health)

**Backend 연동 테스트:**
- [ ] AI 채팅 API가 정상 작동하는가?
- [ ] 파일 내용이 AI에게 전달되는가?
- [ ] 채팅 기록이 저장되는가?

**Frontend 테스트:**
- [ ] AI 채팅 화면이 정상 표시되는가?
- [ ] 메시지 전송이 정상 작동하는가?
- [ ] 파일 선택 기능이 정상인가?
- [ ] AI 서비스 상태가 정확히 표시되는가?

### 5-3. 예상 질문과 답변 예시 💭

**파일 없이 일반 대화:**
- 질문: "안녕하세요!"
- 예상 답변: "안녕하세요! 저는 AI 학습 도우미입니다. 무엇을 도와드릴까요?"

**파일 기반 질문:**
- 질문: "이 문서의 주요 내용을 요약해주세요"
- 예상 답변: 업로드한 파일 내용을 바탕으로 한 요약

**학습 도움 질문:**
- 질문: "이해하기 어려운 부분을 설명해주세요"
- 예상 답변: 문서의 복잡한 개념을 쉽게 설명

## 6. 트러블슈팅 가이드

### 6-1. AI 서비스 문제 🔧

**OpenAI API 키 오류:**
```bash
# .env 파일 확인
cat ai-module/.env

# API 키가 올바른지 확인
# https://platform.openai.com/api-keys
```

**Python 패키지 오류:**
```bash
cd ai-module
pip install --upgrade pip
pip install -r requirements.txt
```

**CORS 오류:**
- FastAPI의 CORS 설정 확인
- allow_origins에 올바른 URL 포함 여부 확인

### 6-2. Backend 연동 문제 🔧

**AI 서비스 연결 실패:**
- AI 서비스가 실행 중인지 확인 (http://localhost:8000)
- Backend 로그에서 연결 오류 메시지 확인
- 방화벽 설정 확인

**WebClient 설정 오류:**
```java
// WebClient 디버깅을 위한 로그 추가
@Bean
public WebClient aiServiceWebClient() {
    return WebClient.builder()
            .baseUrl("http://localhost:8000")
            .filter(ExchangeFilterFunctions.basicAuthentication("user", "pass"))
            .build();
}
```

### 6-3. Frontend 연동 문제 🔧

**API 호출 실패:**
- 브라우저 개발자 도구의 Network 탭 확인
- Backend 서버 상태 확인
- CORS 정책 확인

**채팅 인터페이스 문제:**
- React 컴포넌트 상태 확인
- Console 오류 메시지 확인
- API 응답 형식 확인

## 7. 다음 단계 준비

### 7-1. 오늘 완성된 것들 ✅
- [ ] 간단한 AI 채팅 API 서버
- [ ] Backend와 AI 서비스 연동
- [ ] Frontend AI 채팅 인터페이스
- [ ] 파일 기반 질의응답 기능
- [ ] 기본적인 채팅 기록 저장

### 7-2. 내일 할 일 📝
- 전체 시스템 통합 및 테스트
- 퀴즈 생성 기능 완성
- 사용자 경험 개선
- 배포 준비

### 7-3. 추가 개선사항 (시간이 있다면) 🎯
- PDF 파일 내용 읽기 개선
- 채팅 히스토리 검색 기능
- AI 응답 속도 개선
- 더 자연스러운 대화 흐름

## 8. 보너스: 간단한 퀴즈 기능

### 8-1. 퀴즈 컴포넌트 (선택사항) 🧩
```javascript
// frontend/src/components/quiz/QuizDisplay.js
import React, { useState } from 'react';
import { aiService } from '../../services/aiService';
import Loading from '../common/Loading';
import Alert from '../common/Alert';

const QuizDisplay = ({ user, selectedFile }) => {
  const [quiz, setQuiz] = useState('');
  const [loading, setLoading] = useState(false);
  const [alert, setAlert] = useState(null);

  const generateQuiz = async () => {
    if (!selectedFile) {
      setAlert({ type: 'error', message: '퀴즈를 생성할 파일을 선택해주세요.' });
      return;
    }

    setLoading(true);
    setAlert(null);

    try {
      const response = await aiService.generateQuiz(user.id, selectedFile.id);
      
      if (response.success && response.data.success) {
        setQuiz(response.data.quiz);
      } else {
        setAlert({ type: 'error', message: '퀴즈 생성에 실패했습니다.' });
      }
    } catch (error) {
      setAlert({ type: 'error', message: '퀴즈 생성 중 오류가 발생했습니다.' });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="quiz-display">
      <div className="quiz-header">
        <h3>📝 AI 퀴즈 생성기</h3>
        <button onClick={generateQuiz} disabled={loading || !selectedFile}>
          {loading ? '생성 중...' : '퀴즈 생성'}
        </button>
      </div>

      {alert && <Alert type={alert.type} message={alert.message} onClose={() => setAlert(null)} />}
      
      {loading && <Loading message="AI가 퀴즈를 생성하고 있습니다..." />}
      
      {quiz && (
        <div className="quiz-content">
          <pre>{quiz}</pre>
        </div>
      )}
    </div>
  );
};

export default QuizDisplay;
```
